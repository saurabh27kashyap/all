# Product Finder

Reverse-image product search pipeline that uses Google Lens (via SerpAPI) to pinpoint the exact SKU across Myntra, Slikk, and the brand’s own store using a single script, `product-finder.py`.

## Highlights

- **Visual-first matching**: Every product starts with a pure image search, avoiding reliance on potentially inconsistent titles.
- **Multi-pass strategy**: Automatically escalates to image + query searches (using brand, gender, category, color) when a site is missing.
- **Strict validation**: Per-site URL rules, relaxed brand checks on brand stores, and weighted title similarity with color-based scoring maximize precision.
- **Single CSV in/out**: Consumes a lightweight input sheet and produces a consolidated comparison report with URLs and prices per site.

## Requirements

- Python 3.9+
- `pip install requests`
- A valid [SerpAPI](https://serpapi.com/google-lens) key with Google Lens access.

## Quick Start

1. Place your input CSV (see format below) in the project root.
2. Edit `API_KEY`, `INPUT_FILE`, and `OUTPUT_FILE` at the bottom of `product-finder.py` or pass them programmatically if you import the module.
3. Run:
   ```bash
   python product-finder.py
   ```
4. Inspect the generated output CSV (default: `bd.csv`).

## Input CSV Format

The script expects a UTF‑8 CSV with the following headers (order can vary):

| Column             | Description                                              |
|--------------------|---------------------------------------------------------|
| `style_id`         | Internal reference ID                                   |
| `brand`            | Brand name (used to pick the brand site automatically)  |
| `product_title`    | Title/description from your catalog                     |
| `gender`           | e.g., `Men`, `Women`, `Unisex`                          |
| `category`         | High-level category (`T-shirts`, `Shirts`, etc.)        |
| `min_price_rupees` | Your internal price                                     |
| `first_image_url`  | Publicly accessible image URL                           |

## What the Script Produces

The output CSV mirrors the input columns and adds:
- `klydo_url`: Generated deep link back to your catalog.
- `<site>_url` & `<site>_price`: Pair of columns for each site in scope (Myntra, Slikk, plus the detected brand site).
- Summary coverage stats printed to the console (per-site hit rate and average sites per product).

## How the Search Pipeline Works

1. **Site selection** – `get_allowed_sites()` auto-selects Myntra, Slikk, and a brand storefront if it recognizes the brand (e.g., Bewakoof, Sassafras, TIGC). Add entries to `SHOPPING_SITES` / `brand_mapping` to support new brands.
2. **Pass 1: Pure image search** – `search_image_on_serpapi()` sends the image to Google Lens without a query for the most accurate visual matches.
3. **Candidate filtering** – `extract_product_info()` keeps only matches that:
   - belong to an allowed domain (`identify_site()`),
   - pass relaxed brand checks (marketplaces require brand hints in title/URL),
   - satisfy strict URL rules (rejects category/collection pages),
   - clear similarity thresholds (5% for marketplaces, 15% for brand sites) with color bonuses/penalties.
4. **Pass 2: Image + query** – Only triggered for sites still missing after Pass 1. Uses brand + gender + category (+ first detected color) to nudge Lens toward the exact SKU.
5. **Result selection** – Marketplaces prioritize the top visual rank; brand stores balance similarity vs. rank to choose the safest URL.
6. **Reporting** – Writes enriched rows to CSV and prints a coverage report comparing each site’s hit rate against `COVERAGE_THRESHOLD` (default 50%).

## Customization Tips

- **SerpAPI key**: Replace the `API_KEY` constant or load it from an environment variable.
- **Different CSVs**: Update `INPUT_FILE` / `OUTPUT_FILE` in `__main__` or call `process_products()` directly.
- **More brands/sites**: Extend the `SHOPPING_SITES` dictionary and `brand_mapping`.
- **Thresholds**: Tweak `COVERAGE_THRESHOLD`, similarity percentages, or add new heuristics inside `extract_product_info()`.
- **Rate limiting**: The script sleeps one second between items; increase the delay if you approach SerpAPI’s per-minute limits.

## Troubleshooting

- **“No API results”**: Verify the image URL is publicly reachable and the SerpAPI key permits Google Lens searches.
- **False positives**: Tighten `similarity_threshold` values or extend the URL validation for the affected site.
- **Missed brand site**: Ensure the brand name in CSV matches a key/alias in `brand_mapping`.

## Running Programmatically

`process_products()` is importable; you can wrap it in another script or job runner:

```python
from product_finder import process_products
process_products("input.csv", "output.csv")
```

This allows batch processing of different brand sheets or orchestration in a headless/automated manner, without modifying the main script.

## License

[MIT](LICENSE) or specify your project's license here.
